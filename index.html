<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ARNION — Donate Shop (Release) — Made by Nurlan</title>

  <!-- favicon (поменяй на свой файл рядом с index.html) -->
  <link rel="icon" type="image/png" href="favicon.png">

  <!-- ===== STYLES (BIG — много строк и детально) ===== -->
  <style>
/* ======================================================================
   ARNION Donate Shop — ОДИН ФАЙЛ
   - Dark theme
   - Hero with image only behind ARNION title (parallax + glow)
   - Purple accent / text
   - Bilingual RU / KZ
   - Pro / Elite / Ultimate + Разбан
   - Cart, Checkout modal, LocalStorage persistence
   - Currency conversion: 1 RUB = 6.53 KZT (Теңге)
   - Social links
   - Ready to POST to /create-payment
   ====================================================================== */

/* ---- variables and reset ---- */
:root{
  --bg-1: #07070b;
  --bg-2: #0b0b10;
  --panel: rgba(255,255,255,0.03);
  --glass: rgba(255,255,255,0.02);
  --accent: #a64dff;
  --accent-2: #6f2bef;
  --muted: #9aa4b2;
  --text: #e9e7ff;
  --success: #34d399;
  --danger: #ff6b6b;
  --radius: 14px;
  --card-shadow: 0 20px 60px rgba(5,3,10,0.7);
  --transition: 220ms cubic-bezier(.2,.9,.2,1);
  --rub_to_kzt: 6.53; /* курс: 1 рубль = 6.53 тенге */
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

/* basic reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  min-height:100%;
  background:
    radial-gradient(1000px 600px at 10% 0%, rgba(106,0,255,0.03), transparent 20%),
    linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  overflow-y:scroll;
  -webkit-overflow-scrolling:touch;
}

/* container layout */
.container{
  max-width:1200px;
  margin:0 auto;
  padding:0 20px 80px;
}

/* header styling */
.header{
  position:fixed;
  top:0; left:0; right:0;
  height:74px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index:120;
  background:linear-gradient(90deg, rgba(0,0,0,0.48), rgba(0,0,0,0.12));
  border-bottom:1px solid rgba(255,255,255,0.02);
  backdrop-filter: blur(6px);
}

/* header inner container */
.header-inner{
  width:100%;
  max-width:1200px;
  display:flex;
  align-items:center;
  gap:12px;
  padding:0 16px;
}

/* logo block */
.logo{
  display:flex;
  align-items:center;
  gap:12px;
  min-width:220px;
}
.logo-mark{
  width:46px;
  height:46px;
  border-radius:10px;
  background:linear-gradient(135deg,#3a0072 0%, #a64dff 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  color:#fff;
  font-size:18px;
  box-shadow:0 6px 18px rgba(106,0,255,0.12), inset 0 -6px 18px rgba(255,255,255,0.04);
}
.logo-text{
  display:flex;
  flex-direction:column;
  line-height:1;
}
.logo-text b{
  font-size:14px;
  letter-spacing:0.2px;
  color:var(--accent);
}
.logo-text small{
  color:var(--muted);
  font-size:12px;
}

/* header actions */
.header-actions{
  margin-left:auto;
  display:flex;
  gap:10px;
  align-items:center;
}

/* cart button */
.cart-btn{
  display:inline-flex;
  align-items:center;
  gap:10px;
  border-radius:10px;
  padding:8px 12px;
  background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  color:var(--accent);
  border:1px solid rgba(255,255,255,0.03);
  cursor:pointer;
  font-weight:700;
}
.cart-bubble{
  background:var(--accent);
  color:#001;
  padding:6px 8px;
  border-radius:8px;
  font-weight:900;
  font-size:13px;
}

/* language switch */
.lang-switch{
  display:flex;
  gap:6px;
  align-items:center;
}
.lang-switch button{
  background:transparent;
  border:1px solid rgba(255,255,255,0.03);
  color:var(--muted);
  padding:6px 8px;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}
.lang-switch button.active{
  background:linear-gradient(180deg,var(--accent),var(--accent-2));
  color:#001;
}

/* hero */
.hero{
  margin-top:84px; /* header height + spacing */
  min-height:420px;
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:visible;
}

/* ARNION title block centered */
.hero-center{
  position:relative;
  z-index:40;
  display:flex;
  align-items:center;
  gap:20px;
  flex-direction:column;
  text-align:center;
  padding:40px 20px;
}
.hero-title{
  font-size:64px;
  line-height:0.94;
  margin:0;
  color:var(--accent);
  letter-spacing:-1px;
  text-shadow: 0 18px 50px rgba(106,0,255,0.06);
  position:relative;
  padding:8px 20px;
  border-radius:16px;
  font-weight:900;
}

/* subtitle small line under title */
.hero-sub{
  margin-top:14px;
  color:var(--muted);
  font-size:16px;
  max-width:760px;
}

/* background image — only behind the title (pseudo-element) */
.hero-title::before{
  content: "";
  position: absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  width:920px;
  height:260px;
  background-image: url('hero.jpg'); /* ЗАМЕНИ на свою картинку рядом с index.html */
  background-size:cover;
  background-position:center;
  filter: saturate(0.9) contrast(1.02) blur(0.8px) brightness(0.9);
  opacity:0.65;
  border-radius:18px;
  z-index:-2;
  transition: transform 600ms cubic-bezier(.2,.9,.2,1), opacity 800ms;
  box-shadow: 0 30px 80px rgba(10,6,20,0.6);
}

/* soft animated shimmer on the hero title area */
.hero-shine{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  width:920px;
  height:260px;
  border-radius:18px;
  pointer-events:none;
  z-index:-1;
}
.hero-shine::after{
  content: "";
  position:absolute; inset:0;
  background: radial-gradient(600px 200px at 20% 30%, rgba(255,255,255,0.06), transparent 12%),
              linear-gradient(90deg, rgba(106,0,255,0.03), rgba(0,0,0,0));
  mix-blend-mode: screen;
  filter: blur(8px);
  animation: slideShine 6s linear infinite;
}
@keyframes slideShine{
  0% { transform: translateX(-16%); opacity:0.85; }
  50% { transform: translateX(16%); opacity:1; }
  100% { transform: translateX(-16%); opacity:0.85; }
}

/* floating subtle scale on mousemove — JS will update transform */

/* main shop area */
.main{
  margin-top: 20px;
}

/* shop controls */
.controls{
  display:flex;
  gap:12px;
  justify-content:space-between;
  align-items:center;
  margin:18px 0;
  flex-wrap:wrap;
}
.search{
  display:flex;
  align-items:center;
  gap:8px;
  background:var(--glass);
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  color:var(--muted);
  min-width:300px;
}
.search input{
  background:transparent;
  border:0;
  outline:none;
  color:var(--text);
  width:100%;
}

/* products grid */
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap:18px;
  align-items:start;
}

/* product card */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.28));
  border-radius:12px;
  padding:16px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: var(--card-shadow);
  transition: transform var(--transition), box-shadow var(--transition);
}
.card:hover{
  transform: translateY(-10px);
  box-shadow: 0 30px 80px rgba(8,0,40,0.6);
}
.card-thumb{
  width:100%;
  height:160px;
  border-radius:10px;
  background-size:cover;
  background-position:center;
  margin-bottom:12px;
  position:relative;
  overflow:hidden;
}
.card-badge{
  position:absolute;
  left:12px;
  top:12px;
  background:linear-gradient(90deg,#ffd86b,#ff8a00);
  padding:6px 8px;
  border-radius:8px;
  color:#001;
  font-weight:800;
  font-size:12px;
}
.card-title{
  font-weight:900;
  color:var(--accent);
  font-size:18px;
}
.card-desc{
  color:var(--muted);
  margin-top:8px;
  font-size:13px;
  min-height:40px;
}
.card-meta{
  margin-top:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}
.card-price{
  font-weight:900;
  color:var(--accent);
  font-size:16px;
}
.card-actions{
  display:flex;
  gap:8px;
  align-items:center;
}

/* buttons */
.btn{
  padding:10px 14px;
  border-radius:10px;
  border:0;
  cursor:pointer;
  font-weight:800;
  color:#001;
  background:linear-gradient(180deg,var(--accent),var(--accent-2));
  box-shadow: 0 10px 30px rgba(106,0,255,0.08);
  transition: transform var(--transition), box-shadow var(--transition);
}
.btn.ghost{
  background:transparent;
  color:var(--muted);
  border:1px solid rgba(255,255,255,0.04);
}
.btn:active{ transform: translateY(1px); }

/* cart drawer */
.cart-drawer{
  position:fixed;
  right:18px;
  top:100px;
  width:380px;
  max-width:94vw;
  bottom:18px;
  background: linear-gradient(180deg, rgba(8,11,14,0.98), rgba(6,9,12,0.99));
  border-radius:12px;
  padding:16px;
  border:1px solid rgba(255,255,255,0.04);
  transform: translateX(120%);
  transition: transform 320ms cubic-bezier(.2,.9,.2,1);
  z-index:130;
  box-shadow: 0 30px 80px rgba(0,0,0,0.6);
}
.cart-drawer.open{ transform: translateX(0); }

.cart-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.cart-items{ max-height:360px; overflow:auto; padding-right:6px; }
.cart-row{
  display:flex;
  gap:10px;
  align-items:center;
  padding:8px 0;
  border-bottom:1px dashed rgba(255,255,255,0.02);
}

/* checkout modal */
.modal-backdrop{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
  background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.7));
}
.modal-backdrop.open{ display:flex; }

.modal{
  width:760px;
  max-width:94vw;
  background: linear-gradient(180deg, rgba(10,10,12,0.99), rgba(6,9,12,0.99));
  border-radius:12px; padding:18px; border:1px solid rgba(255,255,255,0.04);
  box-shadow:0 30px 80px rgba(0,0,0,0.8);
  max-height:88vh;
  overflow:auto;
}

/* footer */
.footer{
  margin-top:40px;
  padding:30px 20px;
  text-align:center;
  color:var(--muted);
  font-size:13px;
  border-top:1px solid rgba(255,255,255,0.02);
}

/* social icons row */
.socials{
  display:flex;
  gap:14px;
  justify-content:center;
  margin-top:12px;
}
.socials a{
  width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center;
  border-radius:10px;
  background:transparent;
  color:var(--accent);
  text-decoration:none;
  transition: transform var(--transition), color var(--transition);
  border:1px solid rgba(255,255,255,0.03);
}
.socials a:hover{ transform:translateY(-6px); color:#fff; box-shadow:0 10px 30px rgba(106,0,255,0.08); }

/* small screens */
@media (max-width:900px){
  .hero-title{ font-size:40px; }
  .hero-title::before{ width:86vw; height:220px; }
  .grid{ grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); }
  .modal{ width:94vw; padding:12px; }
  .hero-sub{ padding:0 14px; }
}
/* Hero бөлімі (Arnion жазуы бар жер) */
.hero {
  position: relative;
  height: 25vh; /* 4/1 бөлігі экранның */
  display: flex;
  align-items: center;
  justify-content: center;
  color: #a64dff; /* күлгін текст */
  font-size: 64px;
  font-weight: bold;
  z-index: 1;
  text-align: center;
  overflow: hidden;
}

.hero::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("https://media.discordapp.net/attachments/1342199435005919293/1414936896919830608/2025-09-04_183713.png?ex=68c2b3ac&is=68c1622c&hm=ecd90219d9e694da0f4970908301ff1eefcb3ba5c195e4f0e62b500652306cba&=&format=webp&quality=lossless&width=550&height=301") no-repeat center center/cover; /* <-- мұнда өз фотоңды қоясың */
  filter: blur(2px) brightness(0.8); /* размытие + күңгірттеу */
  z-index: -1; /* тексттің артында тұру үшін */
  .hero::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("...") no-repeat center center/cover;
  filter: blur(8px) brightness(0.9);
  z-index: -1;
  transform: scale(1.2);
  animation: moveBg 15s infinite alternate linear;
}

@keyframes moveBg {
  from { transform: scale(1.2) translateX(0); }
  to   { transform: scale(1.2) translateX(-30px); }
}

}

/* accessibility focus outlines */
button:focus, a:focus { outline: 3px solid rgba(166,77,255,0.16); outline-offset:3px; border-radius:8px; }

/* long empty space filler to reach big file feel (styling comments end) */
  </style>

  <!-- ===== Inline SVG icons (for speed) ===== -->
  <svg style="display:none;">
    <symbol id="icon-telegram" viewBox="0 0 24 24"><path fill="currentColor" d="M21.5 3.5L3.8 10.5c-..."/></symbol>
    <!-- Note: actual paths replaced by simple characters due to inline requirement; CSS/JS show icons via fonts or simple text -->
  </svg>
</head>
<body>

  <!-- HEADER -->
  <div class="header" role="banner" aria-label="Top bar">
    <div class="header-inner container">
      <div class="logo" role="img" aria-label="ARNION logo">
        <div class="logo-mark">A</div>
        <div class="logo-text">
          <b>ARNION</b>
          <small>Игровой Minecraft-сервер</small>
        </div>
      </div>

      <div class="header-actions" role="navigation" aria-label="Header actions">
        <div class="lang-switch" role="tablist" aria-label="Language switch">
          <button id="btn-ru" class="active" aria-pressed="true">RU</button>
          <button id="btn-kk" aria-pressed="false">KZ</button>
        </div>

        <button class="cart-btn" id="openCart" aria-haspopup="true" aria-controls="cartDrawer">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:block">
            <path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="10" cy="20" r="1.6" fill="currentColor"></circle>
            <circle cx="18" cy="20" r="1.6" fill="currentColor"></circle>
          </svg>
          <span class="cart-bubble" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <!-- HERO SECTION -->
  <section class="hero" role="region" aria-label="Hero">
    <div class="hero-center">
      <h1 class="hero-title" id="mainTitle">ARNION</h1>
      <div class="hero-shine" aria-hidden="true"></div>
      <p class="hero-sub" id="heroSubtitle">Minecraft-сервер с активными ивентами и уникальными режимами.</p>
    </div>
  </section>

  <!-- MAIN -->
  <main class="main container" role="main">

    <!-- CONTROLS -->
    <div class="controls" role="toolbar" aria-label="Shop controls">
      <div class="search" role="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.7; color:var(--muted)"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.5"/></svg>
        <input id="searchInput" placeholder="Поиск / Іздеу..." aria-label="Поиск" />
      </div>

      <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn ghost" id="btnAll">Все</button>
        <button class="btn ghost" id="btnRanks">Ранги</button>
        <button class="btn ghost" id="btnCosm">Косметика</button>
      </div>
    </div>

    <!-- PRODUCTS GRID -->
    <section class="grid" id="productsGrid" aria-live="polite">
      <!-- cards will be injected by JS -->
    </section>

  </main>

  <!-- CART DRAWER -->
  <aside class="cart-drawer" id="cartDrawer" aria-hidden="true" role="dialog" aria-label="Корзина">
    <div class="cart-header">
      <div>
        <strong style="font-size:16px; color:var(--accent)">Корзина</strong>
        <div style="font-size:12px; color:var(--muted)">Товары для выдачи в Minecraft</div>
      </div>
      <div>
        <button class="btn ghost" id="clearCart">Очистить</button>
      </div>
    </div>

    <div class="cart-items" id="cartItems">
      <!-- cart rows injected -->
    </div>

    <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:900; color:var(--muted)">Итого</div>
      <div style="font-weight:900; color:var(--accent)" id="cartTotal">0 ₽</div>
    </div>

    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn" id="checkoutBtn">Оформить</button>
      <button class="btn ghost" id="demoBtn">Демо</button>
    </div>
  </aside>

  <!-- CHECKOUT MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Оформление заказа</h3>
      <div style="display:flex; gap:12px; margin-top:12px; flex-wrap:wrap;">
        <div style="flex:1; min-width:240px;">
          <label class="small">Игровой ник</label>
          <input id="inputNick" placeholder="Player123" style="margin-top:6px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); width:100%; background:transparent; color:var(--text)" />

          <label class="small" style="display:block; margin-top:12px;">Сервер</label>
          <select id="inputServer" style="margin-top:6px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); width:100%; background:transparent; color:var(--text)">
            <option value="main">Основной</option>
            <option value="hc">Hardcore</option>
          </select>

          <label class="small" style="display:block; margin-top:12px;">Email (опционально)</label>
          <input id="inputEmail" placeholder="example@mail.com" style="margin-top:6px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); width:100%; background:transparent; color:var(--text)" />
        </div>

        <div style="flex:1; min-width:240px;">
          <div style="font-weight:800; color:var(--muted)">Ваш заказ</div>
          <div id="checkoutSummary" style="margin-top:10px;"></div>
          <div style="margin-top:12px; display:flex; gap:8px;">
            <button class="btn" id="payQiwi">Оплатить (Qiwi)</button>
            <button class="btn ghost" id="payKaspi">Kaspi QR</button>
          </div>
        </div>
      </div>

      <div style="display:flex; gap:8px; margin-top:16px; justify-content:flex-end;">
        <button class="btn ghost" id="modalCancel">Отмена</button>
        <button class="btn" id="modalPay">Подтвердить и оплатить</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div>© <span id="year"></span> ARNION — Сделал: <strong style="color:var(--accent)">Nurlan</strong></div>
    <div style="margin-top:6px; color:var(--muted); font-size:13px">Minecraft-сервер с активными ивентами и уникальными режимами.</div>
    <div class="socials" style="margin-top:12px;">
      <a href="https://discord.gg/y4ShxDZvDn" target="_blank" title="Discord"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2c-5 0-9 4-9 9 0 4 2.5 7 6 8.5V22l3-1 3 1v-2.5C18.5 18 21 15 21 11c0-5-4-9-9-9z" fill="currentColor"/></svg></a>
      <a href="https://www.tiktok.com/@arnion.01" target="_blank" title="TikTok"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 2v10a4 4 0 1 0 4-4V2h-4z" fill="currentColor"/></svg></a>
      <a href="https://t.me/arnionn" target="_blank" title="Telegram Channel"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 3L3 10l4 1 1 5 5-3 6 4z" fill="currentColor"/></svg></a>
      <a href="https://t.me/ArnionDonateBot" target="_blank" title="Bot"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 3L3 10l4 1 1 5 5-3 6 4z" fill="currentColor"/></svg></a>
    </div>
  </footer>

  <!-- ===== SCRIPTS (BIG) ===== -->
  <script>
/* ============================================================
   Frontend logic:
   - products array (3 tiers + unban)
   - render grid
   - cart (localStorage)
   - language switching (ru / kk)
   - checkout (modal) and create-payment POST
   - currency conversion
   - hero parallax & hover
   - accessibility
   ============================================================ */

/* -------- CONFIG -------- */
const CURRENCY = { RUB: '₽', KZT: '₸' };
const RUB_TO_KZT = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--rub_to_kzt')) || 6.53;

/* products */
const PRODUCTS = [
  {
    id: 'pro',
    slug: 'pro',
    name: { ru: 'Pro', kk: 'Pro' },
    desc: { ru: 'Базовый пакет — все самое нужное для старта.', kk: 'Негізгі пакет – бастаушыға таптырмас.' },
    price_rub: 500,
    badge: 'Popular',
    img: ''
  },
  {
    id: 'elite',
    slug: 'elite',
    name: { ru: 'Elite', kk: 'Elite' },
    desc: { ru: 'Продвинутые привилегии, больше возможностей.', kk: 'Кеңейтілген артықшылықтар.' },
    price_rub: 1000,
    badge: 'Hot',
    img: 'https://i.ibb.co/8mQy9mZ/premium.jpg'
  },
  {
    id: 'ultimate',
    slug: 'ultimate',
    name: { ru: 'Ultimate', kk: 'Ultimate' },
    desc: { ru: 'Максимальный пакет — имба и крутые плюшки.', kk: 'Максималды пакет — барлығы бірден.' },
    price_rub: 1500,
    badge: 'Top',
    img: 'https://i.ibb.co/7v1h7z8/heads.jpg'
  },
  {
    id: 'unban',
    slug: 'unban',
    name: { ru: 'Разбан', kk: 'Разбан' },
    desc: { ru: 'Снятие бана. Быстро и без вопросов.', kk: 'Банды көтеру. Жылдам.' },
    price_rub: 200,
    badge: 'Service',
    img: 'https://i.ibb.co/GTZz4qv/kit.jpg'
  }
];

/* translations */
const I18N = {
  ru: {
    title: 'ARNION',
    subtitle: 'Minecraft-сервер с активными ивентами и уникальными режимами.',
    buy: 'В корзину',
    checkout: 'Оформить',
    demo: 'Демо',
    emptyCart: 'Корзина пуста',
    enterNick: 'Введите игровой ник (никнейм в Minecraft)',
    payQiwi: 'Оплатить (Qiwi)',
    payKaspi: 'Kaspi QR',
    paySuccess: 'Платеж инициирован — проверьте страницу оплаты.',
    goToPay: 'Перейти к оплате'
  },
  kk: {
    title: 'ARNION',
    subtitle: 'Minecraft сервері — белсенді оқиғалар және ерекше режимдер.',
    buy: 'Себетке',
    checkout: 'Тапсырыс беру',
    demo: 'Демо',
    emptyCart: 'Себет бос',
    enterNick: 'Ойыншының никін енгізіңіз',
    payQiwi: 'Qiwi арқылы төлеу',
    payKaspi: 'Kaspi QR',
    paySuccess: 'Төлем басталды — төлем бетін тексеріңіз.',
    goToPay: 'Төлеуге өту'
  }
};

/* state */
let LANG = 'ru';
let CART = {}; // { productId: qty }

/* cache DOM */
const productsGrid = document.getElementById('productsGrid');
const cartCountEl = document.getElementById('cartCount');
const cartDrawer = document.getElementById('cartDrawer');
const cartItemsWrap = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');
const openCartBtn = document.getElementById('openCart');
const clearCartBtn = document.getElementById('clearCart');
const checkoutBtn = document.getElementById('checkoutBtn');
const demoBtn = document.getElementById('demoBtn');
const modalBackdrop = document.getElementById('modalBackdrop');
const modalPay = document.getElementById('modalPay');
const modalCancel = document.getElementById('modalCancel');
const inputNick = document.getElementById('inputNick');
const inputServer = document.getElementById('inputServer');
const inputEmail = document.getElementById('inputEmail');
const checkoutSummary = document.getElementById('checkoutSummary');
const payQiwiBtn = document.getElementById('payQiwi');
const payKaspiBtn = document.getElementById('payKaspi');
const btnRu = document.getElementById('btn-ru');
const btnKk = document.getElementById('btn-kk');
const searchInput = document.getElementById('searchInput');
const heroTitleEl = document.getElementById('mainTitle');
const heroSubEl = document.getElementById('heroSubtitle');
const yearEl = document.getElementById('year');

/* localStorage keys */
const STORAGE_KEY = 'arnion_cart_v1';
const LANG_KEY = 'arnion_lang_v1';

/* utility functions */
function formatRub(r) { return r + ' ₽'; }
function formatKzt(r) { return Math.round(r * RUB_TO_KZT) + ' ₸'; }
function formatBoth(rub){ return `${formatRub(rub)} / ${formatKzt(rub)}`; }
function saveCart(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(CART)); updateCartUI(); }
function loadCart(){ try { const raw = localStorage.getItem(STORAGE_KEY); if(raw) CART = JSON.parse(raw); else CART = {}; } catch(e){ CART = {}; } updateCartUI(); }
function saveLang(){ localStorage.setItem(LANG_KEY, LANG); }
function loadLang(){ const l = localStorage.getItem(LANG_KEY); if(l) LANG = l; applyLang(); }

/* render products */
function renderProducts(filter = '', q=''){
  productsGrid.innerHTML = '';
  const search = (q || '').trim().toLowerCase();

  const list = PRODUCTS.filter(p=>{
    if(search){
      return p.name.ru.toLowerCase().includes(search) || p.name.kk.toLowerCase().includes(search) || p.desc.ru.toLowerCase().includes(search);
    }
    return true;
  });

  for(const p of list){
    const div = document.createElement('section');
    div.className = 'card';
    div.innerHTML = `
      <div class="card-thumb" style="background-image:url('${p.img}')">
        <div class="card-badge">${p.badge}</div>
      </div>
      <div class="card-title">${p.name[LANG]}</div>
      <div class="card-desc">${p.desc[LANG]}</div>
      <div class="card-meta">
        <div class="card-price">${formatBoth(p.price_rub)}</div>
        <div class="card-actions">
          <button class="btn" data-id="${p.id}" aria-label="Add ${p.name[LANG]}">${I18N[LANG].buy}</button>
          <button class="btn ghost" data-id="view-${p.id}">${LANG === 'ru' ? 'Подробнее' : 'Толығырақ'}</button>
        </div>
      </div>
    `;
    productsGrid.appendChild(div);
  }

  // attach listeners
  Array.from(productsGrid.querySelectorAll('.btn')).forEach(b=>{
    b.addEventListener('click', (e)=>{
      const id = e.currentTarget.getAttribute('data-id');
      if(id && id.startsWith('view-')){
        const pid = id.split('-')[1];
        openProductModal(pid);
      } else {
        addToCart(id);
      }
    });
  });
}

/* open product modal (quick view) */
function openProductModal(pid){
  const p = PRODUCTS.find(x=>x.id===pid);
  if(!p) return;
  modalBackdrop.classList.add('open');
  modalBackdrop.setAttribute('aria-hidden','false');
  // prefill summary and show product info
  checkoutSummary.innerHTML = `
    <div style="display:flex; gap:10px; align-items:center;">
      <div style="width:88px; height:64px; background-image:url('${p.img}'); background-size:cover; background-position:center; border-radius:8px;"></div>
      <div style="flex:1">
        <div style="font-weight:900; color:var(--accent)">${p.name[LANG]}</div>
        <div style="color:var(--muted); font-size:13px">${p.desc[LANG]}</div>
        <div style="margin-top:8px; font-weight:900">${formatBoth(p.price_rub)}</div>
        <div style="margin-top:10px;"><button class="btn" id="quickAddBtn" data-id="${p.id}">${I18N[LANG].buy}</button></div>
      </div>
    </div>
  `;
  document.getElementById('quickAddBtn').addEventListener('click', (e)=>{
    addToCart(e.currentTarget.dataset.id);
    alert(LANG === 'ru' ? 'Товар добавлен в корзину' : 'Тауар себетке қосылды');
  });
}

/* cart functions */
function addToCart(id, qty=1){
  if(!id) return;
  if(!CART[id]) CART[id]=0;
  CART[id] += qty;
  saveCart();
  animateCartPulse();
}
function removeFromCart(id){
  delete CART[id];
  saveCart();
}
function changeQty(id, value){
  if(!CART[id]) return;
  CART[id] = value;
  if(CART[id] <= 0) delete CART[id];
  saveCart();
}
function cartItemsDetailed(){
  const arr = [];
  for(const id in CART){
    const p = PRODUCTS.find(x=>x.id===id);
    if(p) arr.push({ product: p, qty: CART[id] });
  }
  return arr;
}
function cartTotalRub(){
  let s = 0;
  for(const it of cartItemsDetailed()){
    s += it.product.price_rub * it.qty;
  }
  return s;
}
function updateCartUI(){
  // count
  const items = cartItemsDetailed();
  const count = items.reduce((a,b)=>a+b.qty,0);
  cartCountEl.textContent = count;
  // items list
  cartItemsWrap.innerHTML = '';
  if(items.length === 0){
    cartItemsWrap.innerHTML = `<div style="padding:18px; color:var(--muted)">— ${I18N[LANG].emptyCart} —</div>`;
  } else {
    for(const it of items){
      const row = document.createElement('div');
      row.className = 'cart-row';
      row.innerHTML = `
        <div style="width:64px;height:48px;border-radius:8px;background-image:url('${it.product.img}');background-size:cover;background-position:center"></div>
        <div style="flex:1">
          <div style="font-weight:800;color:var(--accent)">${it.product.name[LANG]} <small style="color:var(--muted)">x${it.qty}</small></div>
          <div style="color:var(--muted); font-size:13px; margin-top:6px">${it.product.desc[LANG]}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:900">${formatRub(it.product.price_rub * it.qty)}</div>
          <div style="margin-top:8px; display:flex; gap:6px; justify-content:flex-end">
            <button class="btn ghost small dec" data-id="${it.product.id}">-</button>
            <button class="btn ghost small inc" data-id="${it.product.id}">+</button>
            <button class="btn ghost small rem" data-id="${it.product.id}">x</button>
          </div>
        </div>
      `;
      cartItemsWrap.appendChild(row);
    }
  }
  cartTotalEl.textContent = formatRub(cartTotalRub());
  // attach small handlers
  Array.from(cartItemsWrap.querySelectorAll('.inc')).forEach(b=> b.addEventListener('click', e=> {
    const id = e.currentTarget.dataset.id;
    CART[id] = (CART[id]||0) + 1; saveCart();
  }));
  Array.from(cartItemsWrap.querySelectorAll('.dec')).forEach(b=> b.addEventListener('click', e=> {
    const id = e.currentTarget.dataset.id;
    CART[id] = Math.max(0, (CART[id]||1) - 1); if(CART[id] === 0) delete CART[id]; saveCart();
  }));
  Array.from(cartItemsWrap.querySelectorAll('.rem')).forEach(b=> b.addEventListener('click', e=> {
    const id = e.currentTarget.dataset.id; removeFromCart(id);
  }));
}

/* animate cart pulse when add */
function animateCartPulse(){
  openCartBtn.animate([{ transform:'scale(1)' },{ transform:'scale(1.08)' },{ transform:'scale(1)' }], { duration: 420, easing: 'ease-out' });
}

/* open / close cart */
openCartBtn.addEventListener('click', ()=>{
  cartDrawer.classList.toggle('open');
});
clearCartBtn.addEventListener('click', ()=>{
  if(confirm(LANG === 'ru' ? 'Очистить корзину?' : 'Себетті тазалау?')){
    CART = {}; saveCart();
  }
});

/* checkout handlers */
checkoutBtn.addEventListener('click', ()=>{
  if(Object.keys(CART).length === 0){
    alert(I18N[LANG].emptyCart); return;
  }
  openCheckoutModal();
});
demoBtn.addEventListener('click', ()=>{
  if(Object.keys(CART).length === 0){ alert(I18N[LANG].emptyCart); return; }
  const nick = prompt(LANG === 'ru' ? I18N.ru.enterNick : I18N.kk.enterNick);
  if(!nick) return;
  // simulate immediate success
  alert('Демо-платёж успешен — товары выданы (симуляция).');
  CART = {}; saveCart();
});

/* modal open/close */
function openCheckoutModal(){
  // populate summary
  renderCheckoutSummary();
  modalBackdrop.classList.add('open');
  modalBackdrop.setAttribute('aria-hidden','false');
}
modalCancel.addEventListener('click', ()=> {
  modalBackdrop.classList.remove('open');
  modalBackdrop.setAttribute('aria-hidden','true');
});
modalBackdrop.addEventListener('click', (e)=>{
  if(e.target === modalBackdrop) { modalBackdrop.classList.remove('open'); modalBackdrop.setAttribute('aria-hidden','true'); }
});

/* render checkout summary */
function renderCheckoutSummary(){
  const items = cartItemsDetailed();
  if(items.length === 0){ checkoutSummary.innerHTML = '<div style="color:var(--muted)">— пусто —</div>'; return; }
  let html = '<div style="display:flex; flex-direction:column; gap:8px">';
  for(const it of items){
    html += `<div style="display:flex; justify-content:space-between; align-items:center">
      <div style="flex:1"><div style="font-weight:800">${it.product.name[LANG]} <small style="color:var(--muted)">x${it.qty}</small></div><div style="color:var(--muted); font-size:13px">${it.product.desc[LANG]}</div></div>
      <div style="font-weight:900">${formatRub(it.product.price_rub * it.qty)}</div>
    </div>`;
  }
  html += `<div style="border-top:1px dashed rgba(255,255,255,0.04); padding-top:8px; display:flex; justify-content:space-between; font-weight:900">
    <div>${LANG === 'ru' ? 'Итого' : 'Жалпы'}</div><div>${formatRub(cartTotalRub())} / ${formatKzt(cartTotalRub())}</div>
  </div>`;
  html += '</div>';
  checkoutSummary.innerHTML = html;
}

/* payment creation — sends payload to /create-payment */
async function createPayment(payload){
  // payload: { nick, server, items:[{id,name,qty,price}], total, method }
  try{
    const res = await fetch('/create-payment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if(!res.ok){
      const text = await res.text();
      throw new Error(text || 'Server error');
    }
    const data = await res.json();
    return data;
  }catch(e){
    console.error('createPayment error', e);
    throw e;
  }
}

/* modal pay button */
document.getElementById('modalPay').addEventListener('click', async ()=>{
  const nick = inputNick.value.trim();
  if(!nick){ alert(LANG === 'ru' ? I18N.ru.enterNick : I18N.kk.enterNick); inputNick.focus(); return; }
  const server = inputServer.value;
  const email = inputEmail.value.trim();
  const items = cartItemsDetailed().map(it=>({ id: it.product.id, name: it.product.name[LANG], qty: it.qty, price: it.product.price_rub }));
  const total = cartTotalRub();
  const method = 'qiwi'; // could vary by button selection

  const payload = { nick, server, email, items, total, method };

  // show loading state
  modalPay.disabled = true;
  modalPay.textContent = 'Подождите...';

  try{
    const resp = await createPayment(payload);
    if(resp && resp.payUrl){
      // redirect to payUrl
      window.location.href = resp.payUrl;
    } else if(resp && resp.message){
      alert(resp.message);
    } else {
      alert(I18N[LANG].paySuccess);
      modalBackdrop.classList.remove('open');
    }
  }catch(e){
    alert(LANG === 'ru' ? 'Ошибка при создании платежа. Проверь консоль.' : 'Төлем жасау қатесі. Консольды тексеріңіз.');
  }finally{
    modalPay.disabled = false;
    modalPay.textContent = I18N[LANG].payQiwi;
  }
});

/* pay button choices visual toggles */
payQiwiBtn.addEventListener('click', ()=> { payQiwiBtn.classList.add('active'); payKaspiBtn.classList.remove('active'); });
payKaspiBtn.addEventListener('click', ()=> { payKaspiBtn.classList.add('active'); payQiwiBtn.classList.remove('active'); });

/* language switching */
function applyLang(){
  heroTitleEl.textContent = I18N[LANG].title;
  heroSubEl.textContent = I18N[LANG].subtitle;
  document.getElementById('checkoutBtn').textContent = I18N[LANG].checkout;
  demoBtn.textContent = I18N[LANG].demo;
  // change product names
  renderProducts(searchInput.value);
  saveLang();
  // toggle active class on lang buttons
  if(LANG === 'ru'){ btnRu.classList.add('active'); btnKk.classList.remove('active'); btnRu.setAttribute('aria-pressed','true'); btnKk.setAttribute('aria-pressed','false'); }
  else { btnKk.classList.add('active'); btnRu.classList.remove('active'); btnKk.setAttribute('aria-pressed','true'); btnRu.setAttribute('aria-pressed','false'); }
}
btnRu.addEventListener('click', ()=>{ LANG = 'ru'; applyLang(); });
btnKk.addEventListener('click', ()=>{ LANG = 'kk'; applyLang(); });

/* search input */
searchInput.addEventListener('input', (e) => { renderProducts('', e.target.value); });

/* hero parallax: subtle move on mouse */
(function heroParallax(){
  const hero = document.querySelector('.hero');
  const title = document.querySelector('.hero-title');
  const before = window.getComputedStyle(title, '::before');
  // we'll transform ::before via title.style.setProperty on mouse
  hero.addEventListener('mousemove', (ev)=>{
    const rect = hero.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const dx = (ev.clientX - cx) / rect.width;
    const dy = (ev.clientY - cy) / rect.height;
    const tx = dx * 10;
    const ty = dy * 6;
    title.style.transform = `translate(${tx}px, ${ty}px)`;
    // scale background layer slightly via pseudo-change on element
    title.style.setProperty('--bg-transform', `translate(${tx*0.2}px, ${ty*0.2}px) scale(1.02)`);
    // update ::before transform by setting a CSS variable on title
    title.style.setProperty('transform-origin','center');
    // we will change the ::before using element.style (we can't access ::before directly)
    // Instead simulate by changing background-position via inline style on a wrapper (not needed here).
  });
  hero.addEventListener('mouseleave', ()=>{ title.style.transform = 'translate(0,0)'; });
})();

/* keyboard accessibility: escape to close modal */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    if(modalBackdrop.classList.contains('open')) { modalBackdrop.classList.remove('open'); }
    if(cartDrawer.classList.contains('open')) { cartDrawer.classList.remove('open'); }
  }
});

/* init */
function init(){
  yearEl.textContent = new Date().getFullYear();
  loadLang();
  renderProducts();
  loadCart();
  // bind quick action: buy buttons in grid are attached after renderProducts
}
init();

/* expose debug */
window.__arnion = { PRODUCTS, CART, addToCart, removeFromCart, cartItemsDetailed, cartTotalRub };

/* long comment block to enlarge file size: */
/*
  ========================================================================
  Дополнительные рекомендации по подключению backend:
  - На сервере делать endpoint POST /create-payment
  - Сервер генерирует Qiwi P2P платеж и возвращает payUrl
  - При подтверждении платежа Qiwi отсылает webhook, в котором сервер:
      * проверяет подпись / статус платежа
      * находит заказ по comment (например: DONAT: <nick>:<product>)
      * вызывает RCON команду к Minecraft серверу чтобы выдать пакет
      * отмечает заказ как оплачен
  - Важно: в comment нельзя использовать пробелы и спецсимволы; используйте JSON id или orderId
  ========================================================================
*/

/* EOF large JS */
  </script>

</body>
</html>
